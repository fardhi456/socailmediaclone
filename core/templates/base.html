<!-- core/templates/base.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Social App{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

</head>
<body id="pageBody" class="bg-light text-dark">
    <!-- 🔝 Navbar -->
    <!-- Navbar -->
    <nav id="mainNavbar" class="navbar navbar-expand-lg navbar-light bg-light shadow-sm fixed-top" style="height: 70px;">
        <div class="container">
            <a class="navbar-brand fw-bold fs-4" href="/">SocialApp</a>

            <!-- Toggle for mobile view -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar content -->
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto align-items-center">
                    {% if user.is_authenticated %}
                        <li class="nav-item me-3" id="usernameGreeting">
                            Hello, <strong>{{ user.username }}</strong>
                        </li>

                        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'create_post' %}">Create Post</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'profile' user.username %}">Profile</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'saved_posts' %}">Saved Posts</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}" onclick="return confirm('Are you sure you want to logout?');">Logout</a></li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="toggleSearch">Search</a>
                        </li>
                    {% else %}
                        <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
                    {% endif %}
                    <li class="nav-item ms-3">
                        <button class="btn btn-sm btn-outline-secondary" id="darkModeToggle" title="Toggle dark mode">🌙</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <!-- 🔍 Hidden Search Bar -->
    <div id="searchBarContainer" class="bg-light py-3 d-none">
        <div class="container">
            <form class="d-flex" role="search" method="get" action="{% url 'search' %}">
                <input 
                    class="form-control me-2" 
                    type="search" 
                    name="q" 
                    placeholder="Search users or posts..." 
                    value="{{ request.GET.q|default_if_none:'' }}" 
                    required>
                <button class="btn btn-outline-primary" type="submit">Search</button>
            </form>
        </div>
    </div>

    <!-- 🧱 Main Content -->
    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 🌗 Dark Mode + Search Toggle Script -->
    <script>
        const darkToggleBtn = document.getElementById("darkModeToggle");
        const pageBody = document.getElementById("pageBody");
        const navbar = document.getElementById("mainNavbar");
        const searchBar = document.getElementById("searchBarContainer");
        const greeting = document.getElementById("usernameGreeting");
        const accountPrompt = document.getElementById("accountPrompt");
        const helpTexts = document.querySelectorAll('[id^="helpText-"]');
        const loginPrompt = document.getElementById('accountLoginPrompt');
        const loginLink = document.getElementById('loginLink');
        const timestamps = document.querySelectorAll('.post-time');

        function applyDarkMode(isDark) {
            if (isDark) {
                pageBody.classList.remove("bg-light", "text-dark");
                pageBody.classList.add("bg-dark", "text-light");

                navbar.classList.remove("navbar-light", "bg-light");
                navbar.classList.add("navbar-dark", "bg-dark");

                searchBar.classList.remove("bg-light");
                searchBar.classList.add("bg-dark");
            } else {
                pageBody.classList.remove("bg-dark", "text-light");
                pageBody.classList.add("bg-light", "text-dark");

                navbar.classList.remove("navbar-dark", "bg-dark");
                navbar.classList.add("navbar-light", "bg-light");

                searchBar.classList.remove("bg-dark");
                searchBar.classList.add("bg-light");
            }

            if (greeting) {
                greeting.classList.toggle("text-muted", !isDark); // light mode
                greeting.classList.toggle("text-light", isDark);  // dark mode
            }

            if (accountPrompt) {
                accountPrompt.classList.toggle("text-light", isDark);
                accountPrompt.classList.toggle("text-muted", !isDark);
            }

            helpTexts.forEach(el => {
                el.classList.toggle('text-muted', !isDark);
                el.classList.toggle('text-light', isDark);
            });

            if (loginPrompt) {
                loginPrompt.classList.toggle('text-muted', !isDark);
                loginPrompt.classList.toggle('text-light', isDark);
            }

            if (loginLink) {
                loginLink.classList.toggle('text-primary', !isDark);
                loginLink.classList.toggle('text-light', isDark);
            }

            timestamps.forEach(el => {
                el.classList.toggle('text-muted', !isDark);
                el.classList.toggle('text-light', isDark);
            });
        }

        const darkMode = localStorage.getItem("darkMode") === "true";
        applyDarkMode(darkMode);

        darkToggleBtn.addEventListener("click", () => {
            const isCurrentlyDark = pageBody.classList.contains("bg-light");
            applyDarkMode(isCurrentlyDark);
            localStorage.setItem("darkMode", isCurrentlyDark);
        });

        document.getElementById("toggleSearch").addEventListener("click", function (e) {
            e.preventDefault();
            searchBar.classList.toggle("d-none");

            if (!searchBar.classList.contains("d-none")) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
